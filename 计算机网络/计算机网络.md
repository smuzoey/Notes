# TCP和UDP



## TCP三次握手和四次挥手

控制位：SYN、ACK，FIN

字段：序号seq，确认号 ack

**同步SYN**：在连接建立时用来同步序号，SYN = 1 就表示这是个连接请求或者连接接受报文。

**确认ACK**：当 ACK = 1 时确认号字段才有效。在 TCP 建立连接后，所有的传送报文段都必须 ACK = 1。

**终止FIN**：释放连接，当 FIN = 1 时，说明报文段的发送方数据已经发送完毕，要求释放运输连接。

请求报文：SYN = 1，ACK = 0

响应报文：SYN = 1，ACK = 1



**三次握手**

1. A 向 B 发送 TCP 请求连接数据包，报文同步标志位 SYN = 1，ACK = 0，主机A的初始序列号 seq(A) = x。（seq = x 表示传输数据第一个序号是 x ）；
2. B 收到请求后，发送连接确认数据包。 SYN = 1，ACK = 1， ack = x +1， seq  = y
3. A 收到 B 的确认报文后， 再做出确认。ACK = 1， ack = y + 1， seq  = x +1



**四次挥手**

1. 关闭客户端到服务端的连接：首先客户端发送一个释放报文，关闭客户端到服务器端的数据传输，然后等待服务器确认。 FIN = 1， seq = u；
2. 服务器接收到到释放报文，发送一个确认ACK = 1， ack  = u+1
3. 服务端向客户端的数据传送完成后，关闭服务器到客户端连接：服务器发送一个释放报文，Fin = 1
4. 客户端收到释放报文后，发送一个确认ACK



**客户端在TIME-WAIT状态等待2MLS？**

1. 保证客户端最后一个确认报文能够到达服务器。
2. 防止“已失效的连接请求报文段“出现在本连接中。使本连接时间内产生的所有报文段都从网络中消失。





# HTTP和HTTPS

HTTP 有以下安全性问题：

- 使用明文进行通信，内容可能会被窃听；
- 不验证通信方的身份，通信方的身份有可能遭遇伪装；
- 无法证明报文的完整性，报文有可能遭篡改。

HTTPS 并不是新协议，而是让 HTTP 先和 SSL（Secure Sockets Layer）通信，再由 SSL 和 TCP 通信，也就是说 HTTPS 使用了隧道进行通信。

通过使用 SSL，HTTPS 具有了加密（防窃听）、认证（防伪装）和完整性保护（防篡改）。

![HTTPS01](E:\notes\pictures\HTTPS01.jpg)





## HTTPS的缺点

虽然说HTTPS有很大的优势，但其相对来说，还是存在不足之处的：

1. HTTPS协议握手阶段比较费时，会使页面的加载时间延长近50%，增加10%到20%的耗电；
2. HTTPS连接缓存不如HTTP高效，会增加数据开销和功耗，甚至已有的安全措施也会因此而受到影响；
3. SSL证书需要钱，功能越强大的证书费用越高，个人网站、小网站没有必要一般不会用。
4. SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名，IPv4资源不可能支撑这个消耗。
5. HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。





## HTTP和HTTPS的区别

HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全。

1. HTTPS需要到ca申请证书，需要一定费用。
2. HTTP是超文本传输协议，信息是明文传输，没有任何加密；HTTPS是具有安全性的ssl加密传输协议。
3. HTTP和HTTPS端口不同，HTTP是80，HTTPS是443。
4. HTTP的连接很简单，是无状态的；HTTPS是由SSL+HTTP协议构建的可加密传输、身份认证的网络协议，HTTPS更加安全。







## HTTPS加密机制

[加密详解](https://www.cnblogs.com/sxiszero/p/11133747.html#1-https-%E6%A6%82%E8%BF%B0)

**对称密钥加密**
	加密和解密使用同一个密钥

**非对称密钥加密**
	公钥密码加密，加密和解密使用不同的密钥







# 浏览器输入一个URL后的过程

1.DNS解析 

2.TCP连接 

3.发送HTTP请求

 4.服务器处理请求并返回HTTP报文

 5.浏览器解析渲染页面



1、在浏览器中输入[www.qq.com](http://www.qq.com/)域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。

2、如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。

3、如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/ip参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。

4、如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。

5、如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址(qq.com)给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找qq.com域服务器，重复上面的动作，进行查询，直至找到[www.qq.com](http://www.qq.com/)主机。

6、如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。

从客户端到本地DNS服务器是属于递归查询，而DNS服务器之间就是的交互查询就是迭代查询。